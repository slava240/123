<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Audio Call</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        .box { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        button { padding: 10px 20px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:disabled { background: #ccc; }
        input { padding: 10px; width: 70%; }
        #status { color: green; font-weight: bold; margin-top: 10px;}
    </style>
</head>
<body>

    <h2>üìû –ê—É–¥–∏–æ-–∑–≤–æ–Ω–æ–∫ (P2P)</h2>

    <div class="box">
        <h3>1. –í–∞—à ID</h3>
        <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –¥—Ä—É–≥—É (–≤ Telegram/WhatsApp):</p>
        <div id="my-id" style="font-weight: bold; font-size: 1.2em;">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è...</div>
    </div>

    <div class="box">
        <h3>2. –ü–æ–∑–≤–æ–Ω–∏—Ç—å –¥—Ä—É–≥—É</h3>
        <input type="text" id="friend-id" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ ID –¥—Ä—É–≥–∞ —Å—é–¥–∞">
        <button id="call-btn">–ü–æ–∑–≤–æ–Ω–∏—Ç—å üìû</button>
    </div>

    <div id="status">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
    <audio id="remote-audio" autoplay></audio>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PeerJS (–∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä)
        const peer = new Peer(); 
        
        const myIdEl = document.getElementById('my-id');
        const friendIdInput = document.getElementById('friend-id');
        const callBtn = document.getElementById('call-btn');
        const statusEl = document.getElementById('status');
        const remoteAudio = document.getElementById('remote-audio');

        // 1. –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—É—á–∞–µ–º —Å–≤–æ–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
        peer.on('open', (id) => {
            myIdEl.innerText = id;
            statusEl.innerText = "–ì–æ—Ç–æ–≤ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é. –ñ–¥—É –∑–≤–æ–Ω–∫–∞ –∏–ª–∏ –∑–≤–æ–Ω–∏—Ç–µ —Å–∞–º–∏.";
        });

        // 2. –õ–æ–≥–∏–∫–∞ "–Ø –∑–≤–æ–Ω—é –∫–æ–º—É-—Ç–æ"
        callBtn.addEventListener('click', () => {
            const friendId = friendIdInput.value;
            if (!friendId) return alert("–í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞!");

            statusEl.innerText = "–ó–≤–æ–Ω—é...";
            
            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É (video: false - —Ç–æ–ª—å–∫–æ –∑–≤—É–∫)
            navigator.mediaDevices.getUserMedia({ video: false, audio: true })
                .then((stream) => {
                    // –ó–≤–æ–Ω–∏–º –¥—Ä—É–≥—É –∏ –ø–µ—Ä–µ–¥–∞–µ–º —Å–≤–æ–π –ø–æ—Ç–æ–∫ (–≥–æ–ª–æ—Å)
                    const call = peer.call(friendId, stream);
                    
                    // –ö–æ–≥–¥–∞ –¥—Ä—É–≥ –æ—Ç–≤–µ—Ç–∏—Ç, –º—ã —É—Å–ª—ã—à–∏–º –µ–≥–æ –ø–æ—Ç–æ–∫
                    call.on('stream', (remoteStream) => {
                        statusEl.innerText = "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ! –ì–æ–≤–æ—Ä–∏—Ç–µ.";
                        remoteAudio.srcObject = remoteStream;
                    });
                })
                .catch((err) => {
                    console.error("–û—à–∏–±–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞:", err);
                    alert("–ù—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É!");
                });
        });

        // 3. –õ–æ–≥–∏–∫–∞ "–ú–Ω–µ –∑–≤–æ–Ω—è—Ç"
        peer.on('call', (call) => {
            if (confirm("–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫! –û—Ç–≤–µ—Ç–∏—Ç—å?")) {
                // –ü–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–µ–º—É –º–∏–∫—Ä–æ—Ñ–æ–Ω—É, —á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç–∏—Ç—å
                navigator.mediaDevices.getUserMedia({ video: false, audio: true })
                    .then((stream) => {
                        // –û—Ç–≤–µ—á–∞–µ–º –Ω–∞ –∑–≤–æ–Ω–æ–∫ —Å–≤–æ–∏–º –ø–æ—Ç–æ–∫–æ–º
                        call.answer(stream); 
                        
                        // –ö–æ–≥–¥–∞ —Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å, —Å–ª—É—à–∞–µ–º —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
                        call.on('stream', (remoteStream) => {
                            statusEl.innerText = "–†–∞–∑–≥–æ–≤–æ—Ä –∏–¥–µ—Ç...";
                            remoteAudio.srcObject = remoteStream;
                        });
                    });
            } else {
                statusEl.innerText = "–ó–≤–æ–Ω–æ–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω.";
            }
        });
    </script>
</body>
</html>
